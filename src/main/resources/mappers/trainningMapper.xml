<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spidernet.dashboard.dao.TrainningMapper">
	<resultMap id="trainningMap" type="com.spidernet.dashboard.entity.Trainning">
		<id property="trainningId" column="TRAINING_ID" javaType="String" />
		<result property="courseName" column="COURSE_NAME" javaType="String" />
		<result property="time" column="TIME" javaType="String" />
		<result property="location" column="LOCATION" javaType="String" />
		<result property="teacher" column="TEACHER" javaType="String" />
		<result property="url" column="URL" javaType="String" />
		<result property="status" column="STATUS" javaType="String" />
	</resultMap>

	<select id="fetchAllTrainning" resultMap="trainningMap">
		select TRAINING_ID, COURSE_NAME, DATE_FORMAT(TIME,'%Y-%m-%d %H:%i') as time, LOCATION, TEACHER, URL, STATUS
		from t_training where NOW() &lt; date_sub(TIME,interval 1 day) AND TRAINING_ID in (select TRAINING_ID FROM
		t_capability_training where CAPABILITY_ID =
		#{capabilityId}) AND TRAINING_ID NOT IN (select TRAINING_ID FROM t_personal_training WHERE EMPLOYEE_ID = #{employeeId});
	</select>
	
	<insert id="addTraining" parameterType="com.spidernet.dashboard.entity.Trainning">
	    insert into t_training (TRAINING_ID,COURSE_NAME,TIME,LOCATION,TEACHER,URL,STATUS)
	    values
	    (#{trainningId},#{courseName},#{time},#{location},#{teacher},#{url},#{status})
	</insert>
	
	<select id="queryTrainingInfo" parameterType="com.spidernet.dashboard.entity.TrainningPageCondition"
		resultMap="trainningMap">
	    select * FROM t_training where 1 = 1
	    <if test="trainningName != null and trainningName != ''">
				AND COURSE_NAME like CONCAT('%',#{trainningName},'%')
		</if>
		ORDER BY TIME ASC
		LIMIT #{currentPage},10;
	</select>
	
	<select id="countTrainingPage" parameterType="com.spidernet.dashboard.entity.TrainningPageCondition"
		resultType="int">
	    select count(0) FROM t_training where 1 = 1
	    <if test="trainningName != null and trainningName != ''">
				AND COURSE_NAME like CONCAT('%',#{trainningName},'%')
		</if>
		ORDER BY TIME ASC
		LIMIT #{currentPage},10;
	</select>
	
	<select id="queryTrainingByName" parameterType="String" resultMap="trainningMap">
	    select * FROM t_training WHERE COURSE_NAME = #{trainingName} ORDER BY TIME DESC
	</select>
	
	<select id="queryTrainingName" resultMap="trainningMap">
	    SELECT DISTINCT COURSE_NAME as courseName FROM t_training ORDER BY COURSE_NAME ASC
	</select>
	
	<select id="queryTrainingById" parameterType="String" resultType="com.spidernet.dashboard.entity.Trainning">
	    SELECT TRAINING_ID as trainningId,COURSE_NAME as courseName,TIME as time,LOCATION as location,TEACHER as teacher,URL as url,STATUS as status FROM t_training WHERE TRAINING_ID = #{trainningId}
	</select>
	
	<select id="queryPersonTrainingNames" parameterType="String" resultType="String">
	    select GROUP_CONCAT(distinct COURSE_NAME) as trainingName from t_employee as a, 
	     t_training as b, t_personal_training as c where
	     a.EMPLOYEE_ID=c.EMPLOYEE_ID and c.TRAINING_ID=b.TRAINING_ID group by a.EMPLOYEE_ID
	     LIMIT #{currentPage},10;
	</select>

</mapper>